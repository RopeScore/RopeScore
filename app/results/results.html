<h1>{{ data[id].config.name }} Results</h1>

<button ng-click="toExcel()">Export to Excel</button>
<button ng-click="toggleRankAll()">{{ (rankAll ? 'Stop Ranking Everyone in Everything' : 'Rank Everyone in Everything') }}</button>

<div class="table">
  <table name="raw">
    <thead>
      <tr>
        <th bold="true" class="blank" noborders colspan="{{ (Abbr.hasTeams(data[id].config.subevents) ? 4 : 3) }}" rowspan="2"></th>
        <th bold="true" colspan="{{ header(data[id].config.subevents, 'sr', 2) }}" ng-if="Abbr.hasType(data[id].config.subevents, 'sr')">Single Rope</th>
        <th bold="true" colspan="{{ header(data[id].config.subevents, 'dd', 2) }}" ng-if="Abbr.hasType(data[id].config.subevents, 'dd')">Double Dutch</th>
        <th bold="true" colspan="3" rowspan="2">Overall</th>
      </tr>
      <tr>
        <!-- FIXME? -->
        <th bold="true" colspan="{{ (Abbr.isSpeed(event) ? 2 : 10) }}" ng-repeat="event in Abbr.events() track by $index" ng-if="data[id].config.subevents[event]">{{ Abbr.unabbr(event)}}</th>
      </tr>
      <tr>
        <th bold="true">{{ (Abbr.hasTeams(data[id].config.subevents) ? "Team Name" : "Name") }}</th>
        <th bold="true" ng-if="Abbr.hasTeams(data[id].config.subevents)">Team Members</th>
        <th bold="true">Club</th>
        <th bold="true">id</th>

        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)"
          ng-repeat-start="event in Abbr.events() track by $index">Required Elements</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Presentation</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Difficulty</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Deductions</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Creativity - (deductions / 2)</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Rank</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Difficulty - (deductions / 2)</th>
        <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">Rank</th>
        <th bold="true" ng-if="data[id].config.subevents[event]">Score</th>
        <th bold="true" ng-if="data[id].config.subevents[event]" class="red" argb="FFFF0000"
          ng-repeat-end>{{ ((data[id].config.simplified || data[id].config.enableFactors) && data[id].config.factors && data[id].config.factors[event]
          ? (data[id].config.factors[event] != 1 ? data[id].config.factors[event]
          + 'x' : '') : (event == 'srsf' ? '2x' : '')) }} Rank</th>

        <th bold="true">Score</th>
        <th bold="true" class="green" argb="FF008000">Rank Sum</th>
        <th bold="true" class="red" argb="FFFF0000">Rank</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="part in partArray | orderBy : ['rank','uid']" ng-style="($even ? {} : {'background-color':'#eee'})">
        <td>{{ part.name }}</td>
        <td class="sm" ng-if="Abbr.hasTeams(data[id].config.subevents)">{{ part.members }}</td>
        <td>{{ part.club }}</td>
        <td>{{ part.uid }}</td>

        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)" ng-repeat-start="event in Abbr.events() track by $index">{{ roundTo(finalscores[part.uid][event].T3, 2) }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ roundTo(finalscores[part.uid][event].T2, 2) }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ roundTo(finalscores[part.uid][event].T1, 2) }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ (finalscores[part.uid][event].T5 !== undefined && !finalscores[part.uid][event].dns  ? -roundTo(finalscores[part.uid][event].T5, 2) : '') }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ (!finalscores[part.uid][event].dns ? roundTo(finalscores[part.uid][event].T4 - (finalscores[part.uid][event].T5 / 2), 2) : '') }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ ranks[event][part.uid].crea }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ (!finalscores[part.uid][event].dns ? roundTo(finalscores[part.uid][event].T1 - (finalscores[part.uid][event].T5 / 2), 2) : '') }}</td>
        <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)">{{ ranks[event][part.uid].diff }}</td>

        <td ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)" ng-class="{gray: finalscores[part.uid][event].dns}">{{ roundTo(finalscores[part.uid][event].A, 2) }}{{ (finalscores[part.uid][event].dns ? 'DNS' : '') }}</td>
        <td ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event)" class="red" argb="FFFF0000">{{ ranks[event][part.uid].total.mult }}</td>

        <td ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event)" ng-class="{gray: finalscores[part.uid][event].dns}">{{ roundTo(finalscores[part.uid][event].PreY, 2) }}{{ (finalscores[part.uid][event].dns ? 'DNS' : '') }}</td>
        <td ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event)" class="red" argb="FFFF0000" ng-repeat-end>{{ ranks[event][part.uid].mult }}</td>


        <td>{{ roundTo(finalscores[part.uid].final, 2) }}</td>
        <td class="green" argb="FF008000">{{ ranksums[part.uid] }}</td>
        <td class="red" argb="FFFF0000">{{ finalRanks[part.uid] }}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div ng-show="ShowAllTables" class="mt">
  <div class="table">
    <table name="overall">
      <thead>
        <tr>
          <th bold="true" noborders colspan="{{ (3 + (Abbr.hasTeams(data[id].config.subevents) ? 1 : 0) + header(data[id].config.subevents, 'sr', true) + header(data[id].config.subevents, 'dd', true) + 3) }}">{{ data[id].config.name }} Overall Results</th>
        </tr>
        <tr>
          <th bold="true" colspan="{{ (Abbr.hasTeams(data[id].config.subevents) ? 4 : 3) }}" rowspan="2"></th>
          <th bold="true" colspan="{{ header(data[id].config.subevents, 'sr', true) }}"
            ng-if="Abbr.hasType(data[id].config.subevents, 'sr')">Single Rope</th>
          <th bold="true" colspan="{{ header(data[id].config.subevents, 'dd', true) }}"
            ng-if="Abbr.hasType(data[id].config.subevents, 'dd')">Double Dutch</th>
          <th bold="true" colspan="3" rowspan="2">Overall</th>
        </tr>
        <tr>
          <th bold="true" colspan="{{ colCount(event, true) }}" ng-repeat="event in Abbr.events() track by $index" ng-if="data[id].config.subevents[event]">{{ Abbr.unabbrNoType(event)}}</th>
        </tr>
        <tr>
          <th bold="true">{{ (Abbr.hasTeams(data[id].config.subevents) ? "Team Name" : "Name") }}</th>
          <th bold="true" ng-if="Abbr.hasTeams(data[id].config.subevents)">Team Members</th>
          <th bold="true">Club</th>
          <th bold="true">id</th>

          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'rq')" ng-repeat-start="event in Abbr.events() track by $index">Req El</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'pres')">Pres</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'diff')">Diff</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'deduc')">Deduc</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'cScore')">Crea - Deduc/2</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'cRank')">Rank</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'dScore')">Diff - Deduc/2</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'dRank')">Rank</th>

          <th bold="true" ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event) && showCol('overall', 'speed', 'score')">Score</th>
          <th bold="true" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'score')">Score</th>

          <th bold="true" ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event) && showCol('overall', 'speed', 'rank')" class="red" argb="FFFF0000">Rank</th>
          <th bold="true" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'rank')" class="red" argb="FFFF0000" ng-repeat-end>Rank</th>

          <th bold="true">Score</th>
          <th bold="true" class="green" argb="FF008000">Rank Sum</th>
          <th bold="true" class="red" argb="FFFF0000">Rank</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="part in partArray | orderBy : ['overallRank','uid']" ng-style="($even ? {} : {'background-color':'#eee'})"
          ng-if="rankAll || inAll(data[id].config.subevents, data[id].scores[part.uid])">
          <td>{{ data[id].participants[part.uid].name }}</td>
          <td class="sm" ng-if="Abbr.hasTeams(data[id].config.subevents)">{{ data[id].participants[part.uid].members }}</td>
          <td>{{ data[id].participants[part.uid].club }}</td>
          <td>{{ part.uid }}</td>

          <td ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event) && showCol('overall', 'speed', 'score')" ng-repeat-start="event in Abbr.events() track by $index">{{ roundTo(overallFinalscores[part.uid][event].Y, 2) }}</td>

          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'rq')">{{ roundTo(overallFinalscores[part.uid][event].T3, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'pres')">{{ roundTo(overallFinalscores[part.uid][event].T2, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'diff')">{{ roundTo(overallFinalscores[part.uid][event].T1, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'deduc')">{{ (overallFinalscores[part.uid][event].T5 !== undefined ? -roundTo(overallFinalscores[part.uid][event].T5, 2) : '') }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'cScore')">{{ toMinScore(roundTo(overallFinalscores[part.uid][event].T4 - (overallFinalscores[part.uid][event].T5 / 2), 2)) }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'cRank')">{{ overallRanks[event][part.uid].crea }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'dScore')">{{ toMinScore(roundTo(overallFinalscores[part.uid][event].T1 - (overallFinalscores[part.uid][event].T5 / 2), 2)) }}</td>
          <td class="gray" argb="FF808080" ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'dRank')">{{ overallRanks[event][part.uid].diff }}</td>
          <td ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'score')">{{ roundTo(overallFinalscores[part.uid][event].A, 2) }}</td>

          <td ng-if="data[id].config.subevents[event] && Abbr.isSpeed(event) && showCol('overall', 'speed', 'rank')" class="red" argb="FFFF0000">{{ overallRanks[event][part.uid].rank }}</td>
          <td ng-if="data[id].config.subevents[event] && !Abbr.isSpeed(event) && showCol('overall', 'freestyle', 'rank')" class="red" argb="FFFF0000" ng-repeat-end>{{ overallRanks[event][part.uid].total.rank }}</td>

          <td>{{ roundTo(overallFinalscores[part.uid].final, 2) }}</td>
          <td class="green" argb="FF008000">{{ overallRanksums[part.uid] }}</td>
          <td class="red" argb="FFFF0000">{{ overallFinalRanks[part.uid] }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="table" ng-repeat="event in Abbr.events() track by $index" ng-if="data[id].config.subevents[event]">
    <table name="{{ event }}" class="mt">
      <thead>
        <tr>
          <th bold="true" colspan="{{ 3 + (Abbr.hasTeams(data[id].config.subevents) ? 1 : 0) + colCount(event) }}">{{ data[id].config.name }} Scores: {{ Abbr.unabbr(event)}}</th>
        </tr>
        <tr>
          <th bold="true">{{ (Abbr.hasTeams(data[id].config.subevents) ? " Team Name " : "Name ") }}</th>
          <th bold="true" ng-if="Abbr.hasTeams(data[id].config.subevents)">Team Members</th>
          <th bold="true">Club</th>
          <th bold="true">id</th>

          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rq')">Req El</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'pres')">Pres</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'diff')">Diff</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'deduc')">Deduc</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'cScore')">Crea - Deduc/2</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'cRank')">Rank</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'dScore')">Diff - Deduc/2</th>
          <th bold="true" class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'dRank')">Rank</th>

          <th bold="true" ng-if="Abbr.isSpeed(event) && showCol('events', 'speed', 'score')">Score</th>
          <th bold="true" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'score')">Score</th>
          <th bold="true" class="green" argb="FF008000" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rsum')">Rank Sum</th>
          <th bold="true" class="red" argb="FFFF0000" ng-if="Abbr.isSpeed(event) && showCol('events', 'speed', 'rank')">Rank</th>
          <th bold="true" class="red" argb="FFFF0000" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rank')">Rank</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="part in rankArray | orderBy : [event + '.rank', 'uid']" ng-style="($even ? {} : { 'background-color': '#eee'})"
          ng-if="part[event]">
          <td>{{ data[id].participants[part.uid].name }}</td>
          <td class="sm" ng-if="Abbr.hasTeams(data[id].config.subevents)">{{ data[id].participants[part.uid].members }}</td>
          <td>{{ data[id].participants[part.uid].club }}</td>
          <td>{{ part.uid }}</td>

          <td ng-if="Abbr.isSpeed(event) && showCol('events', 'speed', 'score')">{{ roundTo(finalscores[part.uid][event].PreY, 2) }}</td>

          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rq')">{{ roundTo(finalscores[part.uid][event].T3, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'pres')">{{ roundTo(finalscores[part.uid][event].T2, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'diff')">{{ roundTo(finalscores[part.uid][event].T1, 2) }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'deduc')">{{ (finalscores[part.uid][event].T5 !== undefined ? -roundTo(finalscores[part.uid][event].T5, 2) : '') }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'cScore')">{{ toMinScore(roundTo(finalscores[part.uid][event].T4 - (finalscores[part.uid][event].T5 / 2), 2)) }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'cRank')">{{ ranks[event][part.uid].crea }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'dScore')">{{ toMinScore(roundTo(finalscores[part.uid][event].T1 - (finalscores[part.uid][event].T5 / 2), 2)) }}</td>
          <td class="gray" argb="FF808080" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'dRank')">{{ ranks[event][part.uid].diff }}</td>
          <td ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'score')">{{ roundTo(finalscores[part.uid][event].A, 2) }}</td>

          <td class="red" argb="FFFF0000" ng-if="Abbr.isSpeed(event) && showCol('events', 'speed', 'rank')">{{ ranks[event][part.uid].rank }}</td>
          <td class="green" argb="FF008000" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rsum')">{{ ranks[event][part.uid].total.cRank + ranks[event][part.uid].total.dRank }}</td>
          <td class="red" argb="FFFF0000" ng-if="!Abbr.isSpeed(event) && showCol('events', 'freestyle', 'rank')">{{ ranks[event][part.uid].total.rank }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- <pre>{{ data[id].ranks | json }}</pre> -->
